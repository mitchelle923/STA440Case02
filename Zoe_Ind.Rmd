---
title: "Zoe_Ind"
author: "Zoe Svec"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
library(dplyr)
library(tidyverse)
library(ggplot2)
```

```{r}
data_2017_2021 <- read_csv("Cleaned Data/data_2017_2021.csv")
data_2022_2023 <- read_csv("Cleaned Data/data_2022_2023.csv")

data_2017_2021 <- data_2017_2021 %>% 
  drop_na(Score, E_Score, D_Score, Apparatus, Round, Location, Competition, Country, Gender)

data_2022_2023 <- data_2022_2023 %>% 
  drop_na(Score, E_Score, D_Score, Apparatus, Round, Location, Competition, Country, Gender)
```

```{r}
# filter by gender, apparatus, qual vs final vs AAfinal vs AAqual vs team qual vs team final, country?

usa_men_22_23 <- data_2022_2023 %>%
  filter(Gender== "m") %>%
  filter(Country == "USA")

print(usa_men_22_23)

usa_women_22_23 <- data_2022_2023 %>%
  filter(Gender== "w") %>%
  filter(Country == "USA") 

print(usa_women_22_23)
```
```{r}
# ggplot(data_2017_2021, aes(x = Date, y = Score, color = Country)) +
#   geom_point() +
#   facet_wrap(~ Apparatus, scales = "free_y") +
#   labs(title = "Scores by Country Faceted by Apparatus")

data_2017_2021 %>%
  filter(Country == "USA") %>%
  ggplot(aes(x = Date, y = Score, color = LastName)) +
  geom_point() +
  facet_wrap(~ Apparatus, scales = "free_y") +
  labs(title = "Scores by Gymnast Faceted by Apparatus")

data_2022_2023 %>%
  filter(Country == "USA") %>%
  filter(Gender == "w") %>%
  ggplot(aes(x = Date, y = Score, color = LastName)) +
  geom_point() +
  facet_wrap(~ Apparatus, scales = "free_y") +
  labs(title = "Scores by Gymnast Faceted by Apparatus") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# data_2022_2023 %>%
#   filter(Country == "USA") %>%
#   filter(Gender == "m") %>%
#   ggplot(aes(x = Date, y = Score, color = LastName)) +
#   geom_point() +
#   facet_wrap(~ Apparatus, scales = "free_y") +
#   labs(title = "Scores by Gymnast Faceted by Apparatus")
```

```{r}
n_distinct(data_2022_2023$Country)

mean(data_2022_2023$Score)
```

```{r}
men_data <- data_2022_2023 %>%
  filter(Gender=="m")

women_data <- data_2022_2023 %>%
  filter(Gender=="w")

data_2022_2023 %>%
  count(Gender)

top_percent_men <- men_data %>%
  group_by(Apparatus) %>%
  filter(rank(desc(Score), ties.method = "min")/n() <= 0.20)

top_percent_women <- women_data %>%
  group_by(Apparatus) %>%
  filter(rank(desc(Score), ties.method = "min")/n() <= 0.20)
```

```{r}
install.packages("rstan")
library(rstan)
```
```{r}
model_string_stan <- "
  data {
    int<lower=0> N;          // Number of historical observations
    vector[N] historical_scores;  // Historical scores
  }
  parameters {
    real mu;                  // Mean of the distribution
    real<lower=0> sigma;       // Standard deviation of the distribution
  }
  model {
    // Priors
    mu ~ normal(mean(historical_scores), sd(historical_scores));
    sigma ~ cauchy(0, 5);

    // Likelihood
    historical_scores ~ normal(mu, sigma);
  }
  generated quantities {
  real future_score[N];  // Simulated scores for the future
  for (i in 1:N) {
    future_score[i] = normal_rng(mu, sigma);
  }
}
"

```

```{r}
data_stan <- list(
  N = length(top_percent_women$Score),
  historical_scores = top_percent_women$Score
)

# Compile the Stan model
stan_model <- stan_model(model_code = model_string_stan)

# Fit the model
stan_samples <- sampling(stan_model, data = data_stan, iter = 1000, chains = 3)

# Extract posterior samples
posterior_samples_stan <- extract(stan_samples)

# Analyze and interpret the results as needed
summary(posterior_samples_stan)

# Extract simulated future scores
simulated_future_scores <- posterior_samples_stan$future_score

simulated_results <- data.frame(Simulated_Score = simulated_future_scores)

```

